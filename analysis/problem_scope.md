# Problem Scope: Autonomous Newtonian Physics Equation Derivation via Transformers

## 1. Problem Statement

Given a set of numerical observations (input-output pairs or time-series trajectories) generated by an unknown Newtonian physics law, the model must recover the symbolic equation governing the relationship between variables. This is a **symbolic regression** task specialized to the domain of classical mechanics, where the model receives raw numerical data and outputs a symbolic mathematical expression.

## 2. Taxonomy of Target Equations by Complexity Tier

### Tier 1: Kinematic Equations (Single-variable, polynomial)
These are the simplest equations involving linear or quadratic relationships between position, velocity, acceleration, and time.

| ID | Equation | Variables | Description |
|----|----------|-----------|-------------|
| K1 | s = u*t + 0.5*a*t² | s, u, a, t | Displacement under constant acceleration |
| K2 | v = u + a*t | v, u, a, t | Velocity under constant acceleration |
| K3 | v² = u² + 2*a*s | v, u, a, s | Velocity-displacement relation |
| K4 | s = v*t | s, v, t | Uniform motion |
| K5 | s = 0.5*(u+v)*t | s, u, v, t | Average velocity displacement |
| K6 | θ = ω₀*t + 0.5*α*t² | θ, ω₀, α, t | Rotational kinematics |
| K7 | ω = ω₀ + α*t | ω, ω₀, α, t | Angular velocity |
| K8 | h = v₀*t - 0.5*g*t² | h, v₀, g, t | Vertical projectile height |
| K9 | x = A*sin(ω*t) | x, A, ω, t | Simple harmonic position |
| K10 | v = A*ω*cos(ω*t) | v, A, ω, t | Simple harmonic velocity |

**Complexity**: 1-3 operators, 2-4 variables, polynomial/trigonometric

### Tier 2: Force Laws (Multi-variable, includes division and products)
These involve Newton's laws and common force expressions.

| ID | Equation | Variables | Description |
|----|----------|-----------|-------------|
| F1 | F = m*a | F, m, a | Newton's second law |
| F2 | F = -k*x | F, k, x | Hooke's law |
| F3 | F = G*m₁*m₂/r² | F, G, m₁, m₂, r | Gravitational force |
| F4 | F = μ*m*g | F, μ, m, g | Friction force |
| F5 | τ = r*F*sin(θ) | τ, r, F, θ | Torque |
| F6 | F = m*v²/r | F, m, v, r | Centripetal force |
| F7 | p = m*v | p, m, v | Linear momentum |
| F8 | L = I*ω | L, I, ω | Angular momentum |
| F9 | F = -b*v | F, b, v | Linear drag force |
| F10 | F = -c*v² | F, c, v | Quadratic drag force |
| F11 | W = F*d*cos(θ) | W, F, d, θ | Work done by force |
| F12 | P = F*v | P, F, v | Power |

**Complexity**: 2-4 operators, 3-5 variables, includes division, products, trigonometric

### Tier 3: Conservation Laws (Composite expressions, equalities between sums)
These involve conservation principles requiring the model to discover equality between compound expressions.

| ID | Equation | Variables | Description |
|----|----------|-----------|-------------|
| C1 | 0.5*m*v² + m*g*h = E | m, v, g, h, E | Conservation of mechanical energy |
| C2 | m₁*v₁ + m₂*v₂ = m₁*v₁' + m₂*v₂' | m₁, m₂, v₁, v₂, v₁', v₂' | Conservation of momentum |
| C3 | 0.5*m*v₁² + m*g*h₁ = 0.5*m*v₂² + m*g*h₂ | m, v₁, h₁, v₂, h₂, g | Energy conservation (two states) |
| C4 | 0.5*k*x² = 0.5*m*v² | k, x, m, v | Spring PE to KE conversion |
| C5 | I₁*ω₁ = I₂*ω₂ | I₁, ω₁, I₂, ω₂ | Angular momentum conservation |
| C6 | T = 2*π*sqrt(L/g) | T, L, g | Pendulum period |
| C7 | T = 2*π*sqrt(m/k) | T, m, k | Spring-mass period |
| C8 | 0.5*m*v₁² = 0.5*m*v₂² + μ*m*g*d | m, v₁, v₂, μ, g, d | Energy with friction loss |
| C9 | KE = 0.5*I*ω² | KE, I, ω | Rotational kinetic energy |
| C10 | v_cm = (m₁*v₁ + m₂*v₂)/(m₁+m₂) | v_cm, m₁, m₂, v₁, v₂ | Center of mass velocity |

**Complexity**: 4-8 operators, 4-6 variables, nested products and sums, square roots

### Tier 4: Coupled/Composite Systems (Multi-equation, differential, complex)
These involve coupled systems, differential relationships, or compositions of multiple physical laws.

| ID | Equation | Variables | Description |
|----|----------|-----------|-------------|
| D1 | x = v₀*cos(θ)*t; y = v₀*sin(θ)*t - 0.5*g*t² | x, y, v₀, θ, t, g | Projectile motion (parametric) |
| D2 | x = (v₀*cos(θ)/b)*(1-exp(-b*t)); y = ... | x, y, v₀, θ, b, g, t | Projectile with linear drag |
| D3 | F = -G*m₁*m₂/r²; a = F/m; v²/r = a | coupled | Circular orbit conditions |
| D4 | x₁ = A₁*cos(ω₁*t+φ₁); x₂ = A₂*cos(ω₂*t+φ₂) | coupled spring-mass | Coupled oscillators |
| D5 | a = g*sin(θ) - μ*g*cos(θ) | a, g, θ, μ | Inclined plane with friction |
| D6 | a = (m₁-m₂)*g/(m₁+m₂) | a, m₁, m₂, g | Atwood machine |
| D7 | v = sqrt(2*g*h*(1+I/(m*r²))⁻¹) | v, g, h, I, m, r | Rolling body on incline |
| D8 | F_net = m*g - b*v; v_terminal = m*g/b | F_net, m, g, b, v | Terminal velocity |
| D9 | T = 2*π*sqrt(I/(m*g*d)) | T, I, m, g, d | Physical pendulum |
| D10 | E = -G*m₁*m₂/(2*a) | E, G, m₁, m₂, a | Orbital energy |
| D11 | ω_precession = τ/(I*ω_spin) | ω_p, τ, I, ω_s | Gyroscopic precession |
| D12 | x(t) = exp(-γt)*(A*cos(ωd*t)+B*sin(ωd*t)) | x, t, γ, A, B, ωd | Damped oscillator |

**Complexity**: 6-12+ operators, 4-8 variables, exponentials, nested compositions, multi-equation systems

## 3. Input Representation Format

### Primary Format: Numerical Observation Pairs
Each training example consists of:
- **Input**: A set of N observation points {(x₁⁽¹⁾, x₂⁽¹⁾, ..., xₖ⁽¹⁾, y⁽¹⁾), ..., (x₁⁽ᴺ⁾, x₂⁽ᴺ⁾, ..., xₖ⁽ᴺ⁾, y⁽ᴺ⁾)}
  - N = 20-100 observation points per equation instance
  - k = number of independent variables (1-6 depending on equation)
  - y = dependent variable value
  - Values represented as floating-point tokens with scientific notation encoding

### Tokenization Strategy
Numerical values are tokenized using a hybrid approach:
1. **Sign token**: `+` or `-`
2. **Mantissa tokens**: digits of mantissa (e.g., `1`, `.`, `5`, `3`)
3. **Exponent token**: `E`, sign, digits (e.g., `E+02`)
4. **Separator tokens**: `SEP` between observation pairs, `VAR_SEP` between variables within a pair
5. **Special tokens**: `[OBS_START]`, `[OBS_END]`, `[EQ_START]`, `[EQ_END]`, `[MASK]`, `[PAD]`

### Variable Naming Convention
Variables are anonymized as x₁, x₂, ..., xₖ, y during training to prevent the model from memorizing variable-name-to-equation mappings. The model must discover the relationship purely from numerical patterns.

## 4. Output Representation Format

### Symbolic Expression Token Sequence
Equations are represented as prefix-notation token sequences (Polish notation), which naturally encode tree structure without parentheses:

**Operator tokens**: `add`, `sub`, `mul`, `div`, `pow`, `sqrt`, `sin`, `cos`, `exp`, `log`, `neg`, `abs`
**Variable tokens**: `x1`, `x2`, ..., `x6`, `y`
**Constant tokens**: Numerical constants using the same tokenization as inputs, plus special constants `pi`, `e`
**Structural tokens**: `[EQ_START]`, `[EQ_END]`, `[PAD]`

**Example**: `F = m*a` → `[EQ_START] mul x1 x2 [EQ_END]` (where x1=m, x2=a, y=F)

**Example**: `s = u*t + 0.5*a*t²` → `[EQ_START] add mul x1 x2 mul mul +5.0E-01 x3 pow x2 +2.0E+00 [EQ_END]`

### Maximum Sequence Length
- Input observations: up to 512 tokens (accommodates ~50 observation points with 4 variables each)
- Output equation: up to 128 tokens (accommodates most Tier 4 equations)

## 5. Quantitative Success Metrics

### Primary Metrics (Per Tier)

#### 5.1 Exact Symbolic Match Rate (ESM)
After canonical simplification via SymPy (expand, simplify, trigsimp), check if the predicted expression is symbolically equivalent to the ground truth. This is the gold-standard metric.

**Targets**:
- Tier 1: ≥ 85% ESM
- Tier 2: ≥ 65% ESM
- Tier 3: ≥ 40% ESM
- Tier 4: ≥ 15% ESM

#### 5.2 R² Score on Held-Out Numerical Predictions
Evaluate the predicted equation by computing R² between its predictions and ground-truth y values on a separate set of observation points not seen during inference.

**Targets**:
- Tier 1: ≥ 0.99 average R²
- Tier 2: ≥ 0.95 average R²
- Tier 3: ≥ 0.90 average R²
- Tier 4: ≥ 0.80 average R²

#### 5.3 Normalized Tree Edit Distance (NTED)
Compute the minimum edit distance between predicted and ground-truth expression trees, normalized by the size of the ground-truth tree. Lower is better.

**Targets**:
- Tier 1: ≤ 0.10 average NTED
- Tier 2: ≤ 0.20 average NTED
- Tier 3: ≤ 0.30 average NTED
- Tier 4: ≤ 0.50 average NTED

#### 5.4 Complexity-Adjusted Accuracy (CAA)
Penalizes predictions that are numerically correct but overly complex (overfitting):
CAA = ESM × (1 - α × max(0, complexity_ratio - 1))
where complexity_ratio = pred_tree_size / gt_tree_size, α = 0.3

### Secondary Metrics
- **Dimensional consistency rate**: Fraction of predictions that are dimensionally valid
- **Inference latency**: Wall-clock time per equation (target: <5s without TTA, <30s with TTA)
- **Data efficiency**: Performance vs. number of observation points provided (20, 50, 100)

### Statistical Reporting
All metrics reported with:
- Mean ± standard deviation across test set
- 95% bootstrap confidence intervals (1000 bootstrap samples)
- Paired comparison p-values (Wilcoxon signed-rank test) against baselines

## 6. Dataset Split Strategy

- **Training set**: 1,000,000 equation-observation pairs
  - Tier 1: 300K (30%), Tier 2: 300K (30%), Tier 3: 250K (25%), Tier 4: 150K (15%)
- **Validation set**: 50,000 pairs (same tier distribution)
- **Test set**: 50,000 pairs (same tier distribution)

**No-leakage guarantee**: Equation templates are split at the template level. If `s = u*t + 0.5*a*t²` is in training, the test set will contain instances with different coefficient values but the same template is allowed (since the model sees numerical data, not the template). However, for Tier 4 coupled systems, specific system configurations are held out entirely.

## 7. Comparison with Prior Work Scope

| Method | Equation Types | # Variables | Noise Handling | Our Advantage |
|--------|---------------|-------------|----------------|---------------|
| SymbolicGPT | Generic symbolic | 1-3 | Limited | Physics-specific, 4+ tiers, up to 6 vars |
| E2E Transformer | Generic symbolic | 1-2 | Yes | Multi-variable, conservation laws, coupled systems |
| AI-Newton | Newtonian mechanics | 2-4 | Denoising | Direct comparison; our model handles more complex coupled systems |
| TPSR | Generic symbolic | 1-3 | No | Iterative refinement vs. MCTS search; handles more complex eqs |
| ODEFormer | ODEs | 1-3 | Yes | Broader equation classes beyond ODEs |
| **PARR (Ours)** | **Newtonian mechanics** | **1-8** | **Multi-level** | **Recursive refinement, physics constraints, TTA** |
